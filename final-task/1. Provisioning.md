# Provisioning 


- Local machine w/ Ansible & Terraform
- Biznet GIO NEO Lite Servers
  - Appserver - 2 CPU, 2GB RAM
  - Gateway - 1 CPU, 1GB RAM
- Others Servers if required

### Instructions

- Attach SSH keys & IP configuration to all VMs
- Server Configuration using Ansible

--- 

Note:
```
Sebelumnya saya dibantu beberapa server/resources untuk pengerjaan final task saya
```

# Terraform

1. Terraform AWS
   Buat akun AWS Free Tier untuk kebutuhan server kita
   
![image](https://github.com/user-attachments/assets/ea94bbb7-f8ca-4b74-b75d-6f352eff2efc)

2. Buat AWS IAM untuk memakai resource dari terraform

![image](https://github.com/user-attachments/assets/8a9beb8f-06b8-410f-aeb7-edeb5cde1430)

3. Buat Setup arsitektur awal menggunakan IAC(Terraform)

![image](https://github.com/user-attachments/assets/ed698da5-809c-4555-80b5-54a9e6ddb9f9)

### provider.tf
```terraform
terraform {
  required_providers {
    aws = {
      source = "hashicorp/aws"
      version = "5.69.0"
    }
  }
}
```

### variables.tf
```
variable "aws_region" {
  description = "The AWS region to deploy in"
  type        = string
  default     = "ap-southeast-1"
}

variable "instance_type" {
  description = "The type of instance to use"
  type        = string
  default     = "t2.micro"
}

variable "ubuntu_ami_id" {
  description = "The AMI ID for Ubuntu 22"
  type        = string
  default     = "ami-03fa85deedfcac80b" 
}


variable "subnet_id" {
  description = "The ID of the subnet where instances will be launched"
  type        = string
  default     = "subnet-0981463b3709fe87a"
}

variable "block_storage_size" {
  description = "Size of the block storage in GiB"
  type        = number
  default     = 20
}

variable "key_name" {
  description = "The name of the SSH key pair"
  type        = string
  default     = "key-finaltask"
}

variable "security_group_id" {
  description = "The ID of the security group"
  type        = string
  default     = "sg-095769e3ec967367f"
}

```

### main.tf
```terraform
provider "aws" {
  region = var.aws_region
}

resource "aws_instance" "ubuntu" {
  ami           = var.ubuntu_ami_id
  instance_type = var.instance_type
  key_name      = var.key_name 
  vpc_security_group_ids = [aws_security_group.allow_all.id]
  subnet_id = var.subnet_id

  tags = {
    Name = "Ubuntu-Server"
  }

  user_data = <<-EOF
              #!/bin/bash
              # Rename ubuntu user to alvaro
              sudo usermod -l alvaro ubuntu
              sudo groupmod -n alvaro ubuntu
              sudo mv /home/ubuntu /home/alvaro
              sudo sed -i 's/ubuntu/alvaro/g' /etc/passwd /etc/shadow /etc/group /etc/sudoers /etc/cloud/cloud.cfg
              echo 'alvaro ALL=(ALL) NOPASSWD:ALL' | sudo tee /etc/sudoers.d/alvaro
              EOF
}

resource "aws_eip" "ubuntu_eip" {
  instance = aws_instance.ubuntu.id
}

data "aws_availability_zones" "available" {}

resource "aws_ebs_volume" "ubuntu_storage" {
  count             = 1
  availability_zone = element(data.aws_availability_zones.available.names, 0) 
  size              = var.block_storage_size
}


resource "aws_volume_attachment" "ubuntu_attach" {
  count       = 1
  device_name = "/dev/sdh"
  volume_id   = aws_ebs_volume.ubuntu_storage[0].id
  instance_id = aws_instance.ubuntu.id
}


resource "aws_security_group" "allow_all" {
  name        = "allow_all"
  description = "Allow all inbound traffic"


  ingress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1" // ALLOW ALL BANG
    cidr_blocks  = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1" // ALLOW ALL BANG
    cidr_blocks  = ["0.0.0.0/0"]
  }
}
```

Jalankan terraform kita dengan

```
 terraform init
 terraform validate
 terrafrom plan
 terraform apply
```


![image](https://github.com/user-attachments/assets/6cf2a439-eb23-4f4b-8a74-00ebe0e236cf)
Check instance di AWS IAM kita, apakah sudah terbentuk apa belum instance 

![image](https://github.com/user-attachments/assets/f79f7c57-798e-47df-ab55-27d49995924e)
